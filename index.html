<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJAX</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body onload="getMake()">
    <h1>API</h1>

        <p>
            The API that I selected is from Makeup API. It provides data about
            different makeup products including their brand, price, images, etc.
        </p>
        <p>
            I found this API from <a href="https://mixedanalytics.com/blog/list-actually-free-open-no-auth-needed-apis/">link</a> 
            which I got from the reading on the website
        </p>
        <p>
            I chose to focus on the id, name, brand, and price of the first 10 products.
        </p>
        <p>
            This could be helpful for a makeup ecommerce website. They would
            be able to access over a thousand different makeup products. It could
            also be used by a consulting agency to filter out certain brands 
            and compare their successes to one another.
        </p>

    <div id="data">Takes Forever to Load...</div>
    <table style="width: 100%">
        <tr>
            <th>ID</th>
            <th>Brand</th>
            <th>Name</th>
            <th>Price</th>
        </tr>
        <tbody id="myTable"></tbody>
    </table>

    <script>
		function getMake() {
			/* Step 1: Make instance of request object...
			...to make HTTP request after page is loaded*/
			request = new XMLHttpRequest();
			console.log("1 - request object created");
 
			// Step 2: Set the URL for the AJAX request to be the JSON file
 
		request.open("GET", "https://makeup-api.herokuapp.com/api/v1/products.json", true)

			console.log("2 - opened request file");
 
			// Step 3: set up event handler/callback

			request.onreadystatechange = function() {
				console.log("3 - readystatechange event fired.");
 
				if (request.readyState == 4 && request.status == 200) {

					// Step 5: wait for done + success
					console.log("5 - response received");


					result = request.responseText;

					par = JSON.parse(result);
                    str = JSON.stringify(par);

                    table = document.getElementById("myTable");


                    for (i = 0; i < 10; i++) {
                        row = `<tr>
                                <td>${par[i].id}</td>
                                <td>${par[i].brand}</td>
                                <td>${par[i].name}</td>
                                <td>${par[i].price}</td>
                                </tr>`
                        table.innerHTML += row;
                    }	
				}
				else if (request.readyState == 4 && request.status != 200) {

					document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";

				}

				else if (request.readyState == 3) {

					document.getElementById("data").innerHTML = "Too soon!  Try again";

				}

			}
		// Step 4: fire off the HTTP request
			request.send();
			console.log("4 - Request sent");
		}
	</script>
    
</body>
</html>